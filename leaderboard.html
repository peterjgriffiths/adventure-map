<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leaderboard | Adventure Map Challenge</title>

  <!-- Link to external CSS file -->
  <link rel="stylesheet" href="css/style.css" />

  
</head>

<body>
  <!-- Website Header with hamburger menu and site title -->
  <header>
  <div class="menu-toggle" id="menu-toggle">&#9776;</div>
  <h1>ğŸ“ Adventure Map Challenge ğŸ“</h1>

    <!-- Hidden nav menu that opens with the hamburger icon -->

  <nav id="navbar">
    <a href="index.html">Map</a>
    <a href="leaderboard.html">Leaderboard</a>
  </nav>
</header>

  <!-- Toggle the hamburger menu -->

<script>
  const menuToggle = document.getElementById('menu-toggle');
  const navbar = document.getElementById('navbar');

  menuToggle.addEventListener('click', () => {
    navbar.classList.toggle('show');
  });
</script>


  <!-- Container for both leaderboards (will be stacked on small screens, side-by-side on wide screens) -->
  <div class="leaderboards-container">
    <div id="leaderboard"></div>
    <div id="location-leaderboard"></div>
  </div>



  <!-- External JavaScript file with players data -->
  <script src="js/players.js"></script>
  <script src="js/photos.js"></script>

  <!-- Leaderboard logic and render -->
  <script>
    // Helper: Get all location names owned by other players
    function getOtherPlayersLocations(currentPlayer) {
      let others = [];
      players.forEach(p => {
        if (p.name !== currentPlayer.name) {
          others = others.concat(p.ownedLocations);
        }
      });
      return [...new Set(others)]; // Remove duplicates
    }

    // Render the people leaderboard (who has visited the most other-players' locations)
    function renderPeopleLeaderboard() {
      const container = document.getElementById("leaderboard");
      container.innerHTML = "";

      const rankedPlayers = players.map(player => {
        const others = getOtherPlayersLocations(player);
        const visited = player.visitedLocations.filter(loc => others.includes(loc));
        return {
          ...player,
          total: others.length,
          visitedCount: visited.length,
          visited
        };
      });

      // Sort: by visited count (descending), then alphabetically (ascending)
      rankedPlayers.sort((a, b) => {
        if (b.visitedCount !== a.visitedCount) {
          return b.visitedCount - a.visitedCount;
        }
        return a.name.localeCompare(b.name);
      });

      // Heading
      const h = document.createElement('h2');
      h.textContent = 'Player Leaderboard';
      container.appendChild(h);

      // Render leaderboard in sorted order with competition ranking (ties share rank)
      let prevScore = null;
      let prevRank = 0;
      rankedPlayers.forEach((player, index) => {
        const percent = player.total > 0 ? (player.visitedCount / player.total) * 100 : 0;
        const rank = (player.visitedCount === prevScore) ? prevRank : (index + 1);
        prevScore = player.visitedCount;
        prevRank = rank;

        const wrapper = document.createElement("div");
        wrapper.className = "player";

        const header = document.createElement("div");
        header.style.display = "flex";
        header.style.alignItems = "center";
        header.style.gap = "10px";
        header.style.marginBottom = "5px";

        const rankEl = document.createElement("div");
        rankEl.className = "player-rank";
        rankEl.textContent = `#${rank}`;
        rankEl.style.fontWeight = "bold";
        rankEl.style.color = "#411e17";
        rankEl.style.minWidth = "35px";

        const name = document.createElement("div");
        name.className = "player-name";
        name.textContent = player.name;

        header.appendChild(rankEl);
        header.appendChild(name);

        const progressContainer = document.createElement("div");
        progressContainer.className = "progress-container";

        const progressBar = document.createElement("div");
        progressBar.className = "progress-bar";
        progressBar.style.width = percent + "%";

        const text = document.createElement("div");
        text.className = "progress-text";
        text.textContent = `${player.visitedCount} out of ${player.total} visited`;

        // details for visited locations
        const details = document.createElement('details');
        details.style.marginTop = '6px';
        const summary = document.createElement('summary');
        summary.textContent = `Show visited locations (${player.visitedCount})`;
        summary.style.fontSize = '13px';
        summary.style.color = '#666';
        summary.style.cursor = 'pointer';
        const list = document.createElement('ul');
        list.style.margin = '6px 0 0 18px';
        list.style.padding = '0';
        player.visited.forEach(locName => {
          const li = document.createElement('li');
          li.textContent = locName;
          list.appendChild(li);
        });
        details.appendChild(summary);
        details.appendChild(list);

        progressContainer.appendChild(progressBar);
        wrapper.appendChild(header);
        wrapper.appendChild(progressContainer);
        wrapper.appendChild(text);
        wrapper.appendChild(details);
        container.appendChild(wrapper);
      });
    }

    // Render the location leaderboard (which locations have most visitors)
    function renderLocationLeaderboard() {
      const container = document.getElementById("location-leaderboard");
      container.innerHTML = "";

      // Heading
      const h = document.createElement('h2');
      h.textContent = 'Location Leaderboard';
      container.appendChild(h);

      // Build stats for each location
      const stats = locations.map(loc => {
        const ownerPlayers = players.filter(p => p.ownedLocations.includes(loc.name));
        const ownersCount = ownerPlayers.length;
        const ownerNames = ownerPlayers.map(p => p.name).join(', ');
        const visitorsCount = players.filter(p => p.visitedLocations.includes(loc.name)).length;
        const maxPossible = Math.max(0, players.length - ownersCount); // Option A: exclude owners
        const percent = maxPossible > 0 ? (visitorsCount / maxPossible) * 100 : 0;
        return {
          name: loc.name,
          ownersCount,
          ownerNames,
          visitorsCount,
          maxPossible,
          percent
        };
      });

      // Sort by visitors desc then name asc
      stats.sort((a, b) => {
        if (b.visitorsCount !== a.visitorsCount) return b.visitorsCount - a.visitorsCount;
        return a.name.localeCompare(b.name);
      });

      // Render each location row with competition ranking and details for visitors
      let prevScore = null;
      let prevRank = 0;
      stats.forEach((s, index) => {
        const rank = (s.visitorsCount === prevScore) ? prevRank : (index + 1);
        prevScore = s.visitorsCount;
        prevRank = rank;

        const wrapper = document.createElement('div');
        wrapper.className = 'player';

        const header = document.createElement('div');
        header.style.display = 'flex';
        header.style.alignItems = 'center';
        header.style.gap = '10px';
        header.style.marginBottom = '5px';

        const rankEl = document.createElement('div');
        rankEl.className = 'player-rank';
        rankEl.textContent = `#${rank}`;
        rankEl.style.fontWeight = 'bold';
        rankEl.style.color = '#411e17';
        rankEl.style.minWidth = '35px';

        const name = document.createElement('div');
        name.className = 'player-name';
        name.textContent = s.name;

        header.appendChild(rankEl);
        header.appendChild(name);

        const ownerInfo = document.createElement('div');
        ownerInfo.style.fontSize = '12px';
        ownerInfo.style.color = '#666';
        ownerInfo.textContent = s.ownerNames ? `Owned by: ${s.ownerNames}` : 'Owned by: â€”';

        const progressContainer = document.createElement('div');
        progressContainer.className = 'progress-container';

        const progressBar = document.createElement('div');
        progressBar.className = 'progress-bar';
        progressBar.style.width = s.percent + '%';

        const text = document.createElement('div');
        text.className = 'progress-text';
        text.textContent = `${s.visitorsCount} out of ${s.maxPossible} visitors`;

        // details for visitors list
        const details = document.createElement('details');
        details.style.marginTop = '6px';
        const summary = document.createElement('summary');
        summary.textContent = `Show visitors (${s.visitorsCount})`;
        summary.style.fontSize = '13px';
        summary.style.color = '#666';
        summary.style.cursor = 'pointer';
        const list = document.createElement('ul');
        list.style.margin = '6px 0 0 18px';
        list.style.padding = '0';
        // populate visitors
        players.filter(p => p.visitedLocations.includes(s.name)).forEach(p => {
          const li = document.createElement('li');
          li.textContent = p.name;
          list.appendChild(li);
        });
        details.appendChild(summary);
        details.appendChild(list);

        progressContainer.appendChild(progressBar);
        wrapper.appendChild(header);
        wrapper.appendChild(ownerInfo);
        wrapper.appendChild(progressContainer);
        wrapper.appendChild(text);
        wrapper.appendChild(details);
        container.appendChild(wrapper);
      });
    }

    // Initial render
    renderPeopleLeaderboard();
    renderLocationLeaderboard();


  </script>
</body>
</html>
