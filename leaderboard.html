<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Leaderboard | Adventure Map Challenge</title>

  <!-- Link to external CSS file -->
  <link rel="stylesheet" href="css/style.css" />

  
</head>

<body>
  <!-- Website Header with hamburger menu and site title -->
  <header>
  <div class="menu-toggle" id="menu-toggle">&#9776;</div>
  <h1>üìç Adventure Map Challenge üìç</h1>

    <!-- Hidden nav menu that opens with the hamburger icon -->

  <nav id="navbar">
    <a href="index.html">Map</a>
    <a href="leaderboard.html">Leaderboard</a>
  </nav>
</header>

  <!-- Toggle the hamburger menu -->

<script>
  const menuToggle = document.getElementById('menu-toggle');
  const navbar = document.getElementById('navbar');

  menuToggle.addEventListener('click', () => {
    navbar.classList.toggle('show');
  });
</script>


  <!-- Placeholder for dynamic leaderboard content -->
  <div class="leaderboard-section">
    <h2 class="leaderboard-title">üèÜ Most Locations Visited</h2>
    <div id="leaderboard-people"></div>
  </div>

  <div class="leaderboard-section">
    <h2 class="leaderboard-title">üìç Most Visited Locations</h2>
    <div id="leaderboard-locations"></div>
  </div>



  <!-- External JavaScript file with players data -->
  <script src="js/players.js"></script>

  <!-- Leaderboard logic and render -->
  <script>
    // Get all location names owned by other players
    function getOtherPlayersLocations(currentPlayer) {
      let others = [];
      players.forEach(p => {
        if (p.name !== currentPlayer.name) {
          others = others.concat(p.ownedLocations);
        }
      });
      return [...new Set(others)]; // Remove duplicates
    }

  // Renders the people leaderboard (who visited most locations)
  function renderPeopleLeaderboard() {
    const container = document.getElementById("leaderboard-people");
    container.innerHTML = "";

    // Build array with calculated stats for sorting
    const rankedPlayers = players.map(player => {
      // Get all locations owned by others
      const others = getOtherPlayersLocations(player);
      const visited = player.visitedLocations.filter(loc => others.includes(loc));
      return {
        ...player,
        total: others.length,
        visitedCount: visited.length,
        visited
      };
    });

    // Sort: by visited count (descending), then alphabetically (ascending)
    rankedPlayers.sort((a, b) => {
      if (b.visitedCount !== a.visitedCount) {
        return b.visitedCount - a.visitedCount; // most visited first
      }
      return a.name.localeCompare(b.name); // alphabetical for ties
    });

    // Render leaderboard in sorted order
    rankedPlayers.forEach((player, index) => {
      const percent = player.total > 0 ? (player.visitedCount / player.total) * 100 : 0;

      // Player container
      const wrapper = document.createElement("div");
      wrapper.className = "player";

      // Header row: rank number + name
      const header = document.createElement("div");
      header.style.display = "flex";
      header.style.alignItems = "center";
      header.style.gap = "10px";
      header.style.marginBottom = "5px";

      const rank = document.createElement("div");
      rank.className = "player-rank";
      rank.textContent = `#${index + 1}`;
      rank.style.fontWeight = "bold";
      rank.style.color = "#411e17";
      rank.style.minWidth = "35px"; // keeps numbers aligned

      const name = document.createElement("div");
      name.className = "player-name";
      name.textContent = player.name;

      header.appendChild(rank);
      header.appendChild(name);

      // Progress bar container
      const progressContainer = document.createElement("div");
      progressContainer.className = "progress-container";

      const progressBar = document.createElement("div");
      progressBar.className = "progress-bar";
      progressBar.style.width = percent + "%";

      // Text below bar
      const text = document.createElement("div");
      text.className = "progress-text";
      text.textContent = `${player.visitedCount} out of ${player.total} visited`;

      // Assemble full player block
      progressContainer.appendChild(progressBar);
      wrapper.appendChild(header);
      wrapper.appendChild(progressContainer);
      wrapper.appendChild(text);
      container.appendChild(wrapper);
    });
  }

  // Renders the locations leaderboard (which locations are most visited)
  function renderLocationsLeaderboard() {
    const container = document.getElementById("leaderboard-locations");
    container.innerHTML = "";

    // Collect all locations and count visitors
    const locationVisits = {};
    
    players.forEach(player => {
      player.visitedLocations.forEach(location => {
        if (!locationVisits[location]) {
          locationVisits[location] = [];
        }
        locationVisits[location].push(player.name);
      });
    });

    // Convert to array and sort by number of visitors (descending), then alphabetically
    const rankedLocations = Object.entries(locationVisits)
      .map(([location, visitors]) => ({ location, visitors, count: visitors.length }))
      .sort((a, b) => {
        if (b.count !== a.count) {
          return b.count - a.count; // most visited first
        }
        return a.location.localeCompare(b.location); // alphabetical for ties
      });

    // Find max count for percentage calculation
    const maxCount = rankedLocations.length > 0 ? rankedLocations[0].count : 1;

    // Render leaderboard in sorted order
    rankedLocations.forEach((item, index) => {
      const percent = (item.count / maxCount) * 100;

      // Location container
      const wrapper = document.createElement("div");
      wrapper.className = "player";

      // Header row: rank number + location name
      const header = document.createElement("div");
      header.style.display = "flex";
      header.style.alignItems = "center";
      header.style.gap = "10px";
      header.style.marginBottom = "5px";

      const rank = document.createElement("div");
      rank.className = "player-rank";
      rank.textContent = `#${index + 1}`;
      rank.style.fontWeight = "bold";
      rank.style.color = "#411e17";
      rank.style.minWidth = "35px";

      const name = document.createElement("div");
      name.className = "player-name";
      name.textContent = item.location;

      header.appendChild(rank);
      header.appendChild(name);

      // Progress bar container
      const progressContainer = document.createElement("div");
      progressContainer.className = "progress-container";

      const progressBar = document.createElement("div");
      progressBar.className = "progress-bar";
      progressBar.style.width = percent + "%";

      // Text below bar
      const text = document.createElement("div");
      text.className = "progress-text";
      const visitorList = item.visitors.join(", ");
      text.textContent = `${item.count} visitor${item.count !== 1 ? 's' : ''}: ${visitorList}`;

      // Assemble full location block
      progressContainer.appendChild(progressBar);
      wrapper.appendChild(header);
      wrapper.appendChild(progressContainer);
      wrapper.appendChild(text);
      container.appendChild(wrapper);
    });
  }

  // Render both leaderboards
  renderPeopleLeaderboard();
  renderLocationsLeaderboard();


  </script>
</body>
</html>
